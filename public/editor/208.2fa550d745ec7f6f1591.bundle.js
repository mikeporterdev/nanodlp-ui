"use strict";(self.webpackChunknanosupport=self.webpackChunknanosupport||[]).push([[208],{2208:(t,e,r)=>{r.r(e),r.d(e,{ThreeMFLoader:()=>s});var n=r(7749),o=r(6488);class s extends n.Loader{constructor(t){super(t),this.availableExtensions=[]}load(t,e,r,o){const s=this,i=new n.FileLoader(s.manager);i.setPath(s.path),i.setResponseType("arraybuffer"),i.setRequestHeader(s.requestHeader),i.setWithCredentials(s.withCredentials),i.load(t,(function(r){try{e(s.parse(r))}catch(e){o?o(e):console.error(e),s.manager.itemError(t)}}),r,o)}parse(t){const e=this,r=new n.TextureLoader(this.manager);function s(t){const e=[],r=(new DOMParser).parseFromString(t,"application/xml").querySelectorAll("Relationship");for(let t=0;t<r.length;t++){const n=r[t],o={target:n.getAttribute("Target"),id:n.getAttribute("Id"),type:n.getAttribute("Type")};e.push(o)}return e}function i(t){const e={id:t.getAttribute("id"),basematerials:[]},r=t.querySelectorAll("base");for(let t=0;t<r.length;t++){const n=c(r[t]);n.index=t,e.basematerials.push(n)}return e}function l(t){const e={id:t.getAttribute("id"),texid:t.getAttribute("texid"),displaypropertiesid:t.getAttribute("displaypropertiesid")},r=t.querySelectorAll("tex2coord"),n=[];for(let t=0;t<r.length;t++){const e=r[t],o=e.getAttribute("u"),s=e.getAttribute("v");n.push(parseFloat(o),parseFloat(s))}return e.uvs=new Float32Array(n),e}function u(t){const e={id:t.getAttribute("id"),displaypropertiesid:t.getAttribute("displaypropertiesid")},r=t.querySelectorAll("color"),o=[],s=new n.Color;for(let t=0;t<r.length;t++){const e=r[t].getAttribute("color");s.setStyle(e.substring(0,7)),s.convertSRGBToLinear(),o.push(s.r,s.g,s.b)}return e.colors=new Float32Array(o),e}function a(t){const e={id:t.getAttribute("id")},r=t.querySelectorAll("pbmetallic"),n=[];for(let t=0;t<r.length;t++){const e=r[t];n.push({name:e.getAttribute("name"),metallicness:parseFloat(e.getAttribute("metallicness")),roughness:parseFloat(e.getAttribute("roughness"))})}return e.data=n,e}function c(t){const e={};return e.name=t.getAttribute("name"),e.displaycolor=t.getAttribute("displaycolor"),e.displaypropertiesid=t.getAttribute("displaypropertiesid"),e}function p(t){const e={};e.objectId=t.getAttribute("objectid");const r=t.getAttribute("transform");return r&&(e.transform=d(r)),e}function d(t){const e=[];t.split(" ").forEach((function(t){e.push(parseFloat(t))}));const r=new n.Matrix4;return r.set(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0,0,0,1),r}function h(t){const e={type:t.getAttribute("type")},r=t.getAttribute("id");r&&(e.id=r);const n=t.getAttribute("pid");n&&(e.pid=n);const o=t.getAttribute("pindex");o&&(e.pindex=o);const s=t.getAttribute("thumbnail");s&&(e.thumbnail=s);const i=t.getAttribute("partnumber");i&&(e.partnumber=i);const l=t.getAttribute("name");l&&(e.name=l);const u=t.querySelector("mesh");u&&(e.mesh=function(t){const e={},r=[],n=t.querySelectorAll("vertices vertex");for(let t=0;t<n.length;t++){const e=n[t],o=e.getAttribute("x"),s=e.getAttribute("y"),i=e.getAttribute("z");r.push(parseFloat(o),parseFloat(s),parseFloat(i))}e.vertices=new Float32Array(r);const o=[],s=[],i=t.querySelectorAll("triangles triangle");for(let t=0;t<i.length;t++){const e=i[t],r=e.getAttribute("v1"),n=e.getAttribute("v2"),l=e.getAttribute("v3"),u=e.getAttribute("p1"),a=e.getAttribute("p2"),c=e.getAttribute("p3"),p=e.getAttribute("pid"),d={};d.v1=parseInt(r,10),d.v2=parseInt(n,10),d.v3=parseInt(l,10),s.push(d.v1,d.v2,d.v3),u&&(d.p1=parseInt(u,10)),a&&(d.p2=parseInt(a,10)),c&&(d.p3=parseInt(c,10)),p&&(d.pid=p),0<Object.keys(d).length&&o.push(d)}return e.triangleProperties=o,e.triangles=new Uint32Array(s),e}(u));const a=t.querySelector("components");return a&&(e.components=function(t){const e=[],r=t.querySelectorAll("component");for(let t=0;t<r.length;t++){const n=p(r[t]);e.push(n)}return e}(a)),e}function g(t){const e={unit:t.getAttribute("unit")||"millimeter"},r=t.querySelectorAll("metadata");r&&(e.metadata=function(t){const e={};for(let r=0;r<t.length;r++){const n=t[r],o=n.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(o)&&(e[o]=n.textContent)}return e}(r));const n=t.querySelector("resources");n&&(e.resources=function(t){const e={basematerials:{}},r=t.querySelectorAll("basematerials");for(let t=0;t<r.length;t++){const n=i(r[t]);e.basematerials[n.id]=n}e.texture2d={};const n=t.querySelectorAll("texture2d");for(let t=0;t<n.length;t++){const r={id:(o=n[t]).getAttribute("id"),path:o.getAttribute("path"),contenttype:o.getAttribute("contenttype"),tilestyleu:o.getAttribute("tilestyleu"),tilestylev:o.getAttribute("tilestylev"),filter:o.getAttribute("filter")};e.texture2d[r.id]=r}var o;e.colorgroup={};const s=t.querySelectorAll("colorgroup");for(let t=0;t<s.length;t++){const r=u(s[t]);e.colorgroup[r.id]=r}e.pbmetallicdisplayproperties={};const c=t.querySelectorAll("pbmetallicdisplayproperties");for(let t=0;t<c.length;t++){const r=a(c[t]);e.pbmetallicdisplayproperties[r.id]=r}e.texture2dgroup={};const p=t.querySelectorAll("texture2dgroup");for(let t=0;t<p.length;t++){const r=l(p[t]);e.texture2dgroup[r.id]=r}e.object={};const d=t.querySelectorAll("object");for(let t=0;t<d.length;t++){const r=h(d[t]);e.object[r.id]=r}return e}(n));const o=t.querySelector("build");return o&&(e.build=function(t){const e=[],r=t.querySelectorAll("item");for(let t=0;t<r.length;t++){const n=r[t],o={objectId:n.getAttribute("objectid")},s=n.getAttribute("transform");s&&(o.transform=d(s)),e.push(o)}return e}(o)),e}function f(t,e,o,s){const i=t.texid,l=o.resources.texture2d[i];if(l){const t=s[l.path],e=l.contenttype,o=new Blob([t],{type:e}),i=URL.createObjectURL(o),u=r.load(i,(function(){URL.revokeObjectURL(i)}));switch(u.encoding=n.sRGBEncoding,l.tilestyleu){case"wrap":default:u.wrapS=n.RepeatWrapping;break;case"mirror":u.wrapS=n.MirroredRepeatWrapping;break;case"none":case"clamp":u.wrapS=n.ClampToEdgeWrapping}switch(l.tilestylev){case"wrap":default:u.wrapT=n.RepeatWrapping;break;case"mirror":u.wrapT=n.MirroredRepeatWrapping;break;case"none":case"clamp":u.wrapT=n.ClampToEdgeWrapping}switch(l.filter){case"auto":default:u.magFilter=n.LinearFilter,u.minFilter=n.LinearMipmapLinearFilter;break;case"linear":u.magFilter=n.LinearFilter,u.minFilter=n.LinearFilter;break;case"nearest":u.magFilter=n.NearestFilter,u.minFilter=n.NearestFilter}return u}return null}function b(t,e,r,o,s,i,l){const u=l.pindex,a={};for(let t=0,r=e.length;t<r;t++){const r=e[t],n=void 0!==r.p1?r.p1:u;void 0===a[n]&&(a[n]=[]),a[n].push(r)}const c=Object.keys(a),p=[];for(let e=0,u=c.length;e<u;e++){const u=c[e],d=a[u],h=w(t.basematerials[u],o,s,i,l,F),g=new n.BufferGeometry,f=[],b=r.vertices;for(let t=0,e=d.length;t<e;t++){const e=d[t];f.push(b[3*e.v1+0]),f.push(b[3*e.v1+1]),f.push(b[3*e.v1+2]),f.push(b[3*e.v2+0]),f.push(b[3*e.v2+1]),f.push(b[3*e.v2+2]),f.push(b[3*e.v3+0]),f.push(b[3*e.v3+1]),f.push(b[3*e.v3+2])}g.setAttribute("position",new n.Float32BufferAttribute(f,3));const m=new n.Mesh(g,h);p.push(m)}return p}function m(t,e,r,o,s,i,l){const u=new n.BufferGeometry,a=[],c=[],p=r.vertices,d=t.uvs;for(let t=0,r=e.length;t<r;t++){const r=e[t];a.push(p[3*r.v1+0]),a.push(p[3*r.v1+1]),a.push(p[3*r.v1+2]),a.push(p[3*r.v2+0]),a.push(p[3*r.v2+1]),a.push(p[3*r.v2+2]),a.push(p[3*r.v3+0]),a.push(p[3*r.v3+1]),a.push(p[3*r.v3+2]),c.push(d[2*r.p1+0]),c.push(d[2*r.p1+1]),c.push(d[2*r.p2+0]),c.push(d[2*r.p2+1]),c.push(d[2*r.p3+0]),c.push(d[2*r.p3+1])}u.setAttribute("position",new n.Float32BufferAttribute(a,3)),u.setAttribute("uv",new n.Float32BufferAttribute(c,2));const h=w(t,o,s,i,l,f),g=new n.MeshPhongMaterial({map:h,flatShading:!0});return new n.Mesh(u,g)}function A(t,e,r,o){const s=new n.BufferGeometry,i=[],l=[],u=r.vertices,a=t.colors;for(let t=0,r=e.length;t<r;t++){const r=e[t],n=r.v1,s=r.v2,c=r.v3;i.push(u[3*n+0]),i.push(u[3*n+1]),i.push(u[3*n+2]),i.push(u[3*s+0]),i.push(u[3*s+1]),i.push(u[3*s+2]),i.push(u[3*c+0]),i.push(u[3*c+1]),i.push(u[3*c+2]);const p=void 0!==r.p1?r.p1:o.pindex,d=void 0!==r.p2?r.p2:p,h=void 0!==r.p3?r.p3:p;l.push(a[3*p+0]),l.push(a[3*p+1]),l.push(a[3*p+2]),l.push(a[3*d+0]),l.push(a[3*d+1]),l.push(a[3*d+2]),l.push(a[3*h+0]),l.push(a[3*h+1]),l.push(a[3*h+2])}s.setAttribute("position",new n.Float32BufferAttribute(i,3)),s.setAttribute("color",new n.Float32BufferAttribute(l,3));const c=new n.MeshPhongMaterial({vertexColors:!0,flatShading:!0});return new n.Mesh(s,c)}function y(t){const e=new n.BufferGeometry;e.setIndex(new n.BufferAttribute(t.triangles,1)),e.setAttribute("position",new n.BufferAttribute(t.vertices,3));const r=new n.MeshPhongMaterial({color:16777215,flatShading:!0});return new n.Mesh(e,r)}function v(t,e){return void 0!==e.resources.texture2dgroup[t]?"texture":void 0!==e.resources.basematerials[t]?"material":void 0!==e.resources.colorgroup[t]?"vertexColors":"default"===t?"default":void 0}function x(t,e,r,o,s){const i=new n.Group,l=function(t,e){const r={},n=t.triangleProperties,o=e.pid;for(let t=0,e=n.length;t<e;t++){const e=n[t];let s=void 0!==e.pid?e.pid:o;void 0===s&&(s="default"),void 0===r[s]&&(r[s]=[]),r[s].push(e)}return r}(t,s),u=function(t,e,r,n,o,s){const i=Object.keys(t),l=[];for(let u=0,a=i.length;u<a;u++){const a=i[u],c=t[a];switch(v(a,n)){case"material":const t=b(n.resources.basematerials[a],c,e,r,n,o,s);for(let e=0,r=t.length;e<r;e++)l.push(t[e]);break;case"texture":const i=n.resources.texture2dgroup[a];l.push(m(i,c,e,r,n,o,s));break;case"vertexColors":const u=n.resources.colorgroup[a];l.push(A(u,c,e,s));break;case"default":l.push(y(e));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}if(s.name)for(let t=0;t<l.length;t++)l[t].name=s.name;return l}(l,t,e,r,o,s);for(let t=0,e=u.length;t<e;t++)i.add(u[t]);return i}function w(t,e,r,n,o,s){return void 0!==t.build||(t.build=s(t,e,r,n,o)),t.build}function F(t,e,r){let o;const s=t.displaypropertiesid,i=r.resources.pbmetallicdisplayproperties;if(null!==s&&void 0!==i[s]){const e=i[s].data[t.index];o=new n.MeshStandardMaterial({flatShading:!0,roughness:e.roughness,metalness:e.metallicness})}else o=new n.MeshPhongMaterial({flatShading:!0});o.name=t.name;const l=t.displaycolor,u=l.substring(0,7);return o.color.setStyle(u),o.color.convertSRGBToLinear(),9===l.length&&(o.opacity=parseInt(l.charAt(7)+l.charAt(8),16)/255),o}function S(t,e,r,o){const s=new n.Group;for(let n=0;n<t.length;n++){const i=t[n];let l=e[i.objectId];void 0===l&&(M(i.objectId,e,r,o),l=e[i.objectId]);const u=l.clone(),a=i.transform;a&&u.applyMatrix4(a),s.add(u)}return s}function M(t,r,n,o){const s=n.resources.object[t];if(s.mesh){const t=s.mesh;!function(t,r,n){if(!t)return;const o=[],s=Object.keys(t);for(let t=0;t<s.length;t++){const r=s[t];for(let t=0;t<e.availableExtensions.length;t++){const n=e.availableExtensions[t];n.ns===r&&o.push(n)}}for(let e=0;e<o.length;e++){const s=o[e];s.apply(n,t[s.ns],r)}}(n.extensions,t,n.xml),r[s.id]=w(t,r,n,o,s,x)}else{const t=s.components;r[s.id]=w(t,r,n,o,s,S)}s.name&&(r[s.id].name=s.name)}const L=function(t){let e,r,i=null,l=null;const u=[],a=[];let c;const p={},d={};try{i=o.unzipSync(new Uint8Array(t))}catch(t){if(t instanceof ReferenceError)return console.error("THREE.3MFLoader: fflate missing and file is compressed."),null}for(l in i)l.match(/\_rels\/.rels$/)?e=l:l.match(/3D\/_rels\/.*\.model\.rels$/)?r=l:l.match(/^3D\/.*\.model$/)?u.push(l):l.match(/^3D\/Textures?\/.*/)&&a.push(l);const h=i[e],f=s(n.LoaderUtils.decodeText(h));if(r){const t=i[r];c=s(n.LoaderUtils.decodeText(t))}for(let t=0;t<u.length;t++){const e=u[t],r=i[e],o=n.LoaderUtils.decodeText(r),s=(new DOMParser).parseFromString(o,"application/xml");"model"!==s.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",e);const l=s.querySelector("model"),a={};for(let t=0;t<l.attributes.length;t++){const e=l.attributes[t];e.name.match(/^xmlns:(.+)$/)&&(a[e.value]=RegExp.$1)}const c=g(l);c.xml=l,0<Object.keys(a).length&&(c.extensions=a),p[e]=c}for(let t=0;t<a.length;t++){const e=a[t];d[e]=i[e].buffer}return{rels:f,modelRels:c,model:p,printTicket:{},texture:d}}(t),k=function(t){const e=t.model,r=t.modelRels,n={},o=Object.keys(e),s={};if(r)for(let e=0,n=r.length;e<n;e++){const n=r[e],o=n.target.substring(1);t.texture[o]&&(s[n.target]=t.texture[o])}for(let t=0;t<o.length;t++){const r=e[o[t]],i=Object.keys(r.resources.object);for(let t=0;t<i.length;t++)M(i[t],n,r,s)}return n}(L);return function(t,e){const r=new n.Group,o=function(t){for(let e=0;e<t.length;e++){const r=t[e];if("model"===r.target.split(".").pop().toLowerCase())return r}}(e.rels),s=e.model[o.target.substring(1)].build;for(let e=0;e<s.length;e++){const n=s[e],o=t[n.objectId].clone(),i=n.transform;i&&o.applyMatrix4(i),r.add(o)}return r}(k,L)}addExtension(t){this.availableExtensions.push(t)}}}}]);